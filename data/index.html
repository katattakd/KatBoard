<!DOCTYPE html>
<html>
<head>
	<meta content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=5" name="viewport">
	<title>KatBoard</title>
	<meta name=theme-color content=#282828>
	<style>body{font-family:Segoe UI,Arial,sans-serif;color:#fff;background-color:#0f0f0f;margin:0;word-wrap:break-word}button{padding:3px 6px}h4{color:#7c2d2d!important}input,p{color:#cdcdcd!important;overflow:auto}img,video{width:25%}img:active,video:active{width:50%}audio,img,video{float:left;padding-right:8px;padding-bottom:8px}a,button{text-decoration:none;color:#6e6e95!important}input{border-bottom:1px solid rgba(0,0,0,.12)!important;transition:border-bottom-color .2s;background-color:#282828!important;box-sizing:border-box;padding-left:4px;width:100%}input:focus{border-bottom:1px solid #f44336!important}#post,button{background-color:#1c1c1c}button,input{font:inherit;outline:0;border:0}#post{border:3px solid #1c1c1c;border-radius:2px;box-shadow:0 2px 2px 0 rgba(0,0,0,.14),0 3px 1px -2px rgba(0,0,0,.2),0 1px 5px 0 rgba(0,0,0,.12)}#post{padding-left:8px;padding-right:8px}#topbar{padding:10px;border-bottom:1px solid #000;background-color:#1c1c1c;display:none}#posts{padding-left:18%;padding-right:18%}.time{float:right;color:#999!important;font-size:12px}@media screen and (max-width:800px){#posts{padding-left:20px;padding-right:20px}img:active,video:active{width:100%}}</style>
	<title>KatBoard Beta</title>
<body>
	<p></p>
	<div id="posts">
		<noscript>
			<div id="post"><h4>Please enable JavaScript for KatBoard to work properly.</h4></div>
		</noscript>
	</div>
	<script>
	document.body.innerHTML='<div id="topbar"><input id="text" onkeydown="if (event.keyCode == 13) {send()}" placeholder="Type something to post..." type="text"><button onclick="send()" type="button">Send</button></div>'+document.body.innerHTML;document.getElementById("posts").innerHTML='<div id="post"><p>Waiting for network connection...</p></div>';var lstub;var xhttp=new XMLHttpRequest();xhttp.onreadystatechange=function(){if(this.readyState==4&&this.status==200){document.getElementById("posts").innerHTML='<div id="post"><p>Connecting to chat server...</p></div>';lstub=this.responseText;if(window.location.search.startsWith("?")){startws(window.location.search+this.responseText)}else{startws("?posts=8"+this.responseText)}}};xhttp.open("GET","mylogin",true);xhttp.send();var timerID=0;var messageSocket;function startws(login){if(location.protocol=='https:'){messageSocket=new WebSocket("wss://"+window.location.host+window.location.pathname+"messagesocket"+login)}else{messageSocket=new WebSocket("ws://"+window.location.host+window.location.pathname+"messagesocket"+login)}messageSocket.onopen=function(event){document.getElementById("topbar").style.display="flex";if(window.timerID){window.clearInterval(window.timerID);window.timerID=0}};messageSocket.onmessage=function(event){document.getElementById("posts").innerHTML=event.data;if(window.location.search==""){document.getElementById("posts").innerHTML+='<div id="post"><p><a href="'+window.location.href+'/newboard">Click here to create a new board!</a></p></div><br>'}};messageSocket.onclose=function(event){if(!window.timerID){window.timerID=setInterval(function(){fetchMsgs(login);startws(login)},2000)}};messageSocket.onerror=function(event){if(!window.timerID){window.timerID=setInterval(function(){fetchMsgs(login);startws(login)},2000)}}}function fetchMsgs(login){var xhttp=new XMLHttpRequest();xhttp.timeout=1900;xhttp.onreadystatechange=function(){if(this.readyState==4&&window.timerID){if(this.status===200&&this.responseText!=null){document.getElementById("topbar").style.display="flex";document.getElementById("posts").innerHTML=this.responseText+'<br><div id="post"><h4>Warning: Your connection is unreliable.</h4><p>KatBoard has detected that your connection is unreliable, and has fallen back to HTTP polling. When your connection improves, KatBoard will automatically switch back to using WebSockets.</p></div><br>'}else{document.getElementById("topbar").style.display="none";document.getElementById("posts").innerHTML='<div id="post"><h4>Warning: You have been disconnected from the server.</h4><p>KatBoard is attempting to establish a new connection with the chat server...</p></div><br>'}}};xhttp.open("GET","getboardmsgs"+login,true);xhttp.send()}function send(){if(window.timerID){var xhttp=new XMLHttpRequest();xhttp.open("GET","sendboardmsg?msg="+document.getElementById("text").value+lstub,true);xhttp.send()}else{messageSocket.send(document.getElementById("text").value)}document.getElementById("text").value=""}
	</script>
</head>
</body>
</html>
